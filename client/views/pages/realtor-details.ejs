<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Realtor Details</title>
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/pages/realtor-details.css">
 <style>
  :root{
    --brand:#2f70c8;              /* your blue accent */
    --ink:#0f172a;                /* dark text */
    --muted:#64748b;              /* secondary text */
    --border:#e5e7eb;             /* light border */
    --surface:#ffffff;
    --radius:14px;
    --gutter-x: 2.25rem;   /* space between the two halves (center gutter) */
  --field-gap-x: 1.25rem;/* space between fields within a half (columns)  */
  --field-gap-y: 1.35rem;   /* vertical space between rows                   */
  }

  .realtor-shell { display:flex; flex-direction:column; gap:1rem; }

  .is-hidden { display: none !important; }
[hidden]   { display: none !important; }

  /* Identity (collapsed) */
 .re-identity,
.realtor-identity {
  position: relative;
  background: var(--surface);
  border: 1px solid var(--border);
  border-left: 3px solid var(--brand);
  border-radius: var(--radius);
  padding: .75rem 1.25rem;           /* ⟵ more left/right padding */
  display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;
  box-shadow: 0 1px 2px rgba(0,0,0,.03);
}

.re-compact { display:flex; align-items:center; gap:1rem; width:100%; }
.re-cta { margin-left:auto; }
  .re-left { display:flex; flex-direction:column; }
  .re-name {
    font-size:1.125rem; line-height:1.25rem;
    font-weight:700; color:var(--ink);
  }
  .re-contact {
    display:flex; align-items:center; gap:1rem;     /* space between phone & email */
    margin-top:.35rem;                               /* space under the name */
    color:var(--muted);
  }
  .re-contact a { color:inherit; text-decoration:none; }
  .re-contact a:hover { text-decoration:underline; }

  .re-cta {
    margin-left:auto;
    display:flex;
    align-items:center;
    gap:.6rem;
    flex-wrap:wrap;
    justify-content:flex-end;
  }
  .re-actions{
    padding:.2rem .45rem;
    border-radius:999px;
    border:1px solid var(--border);
    background:#f8fafc;
  }
  .btn-ghost {
    border:1px solid var(--brand);
    background:transparent; color:var(--brand);
    border-radius:999px; padding:.3rem .8rem; cursor:pointer;
  }
  .btn-ghost:hover { background:rgba(47,112,200,.06); }

  /* Expanded editor */
  .re-editor {
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:var(--radius);
    padding:1rem 1rem 1.25rem;
    box-shadow:0 1px 3px rgba(0,0,0,.04);
  }
  .re-title {
    font-weight:700; color:var(--ink);
    padding-bottom:.5rem; margin-bottom:.75rem;
    border-bottom:1px dashed var(--border);
  }
.d-none { display: none !important; }
.re-grid{
  display: grid;
  grid-template-columns: 1.25fr 1fr;   /* left a bit wider */
  column-gap: var(--gutter-x);         /* ⟵ widen this gutter */
  row-gap: var(--field-gap-y);
  gap: var(--field-gap-y) var(--gutter-x) !important;
}

.re-grid > .re-col{ min-width: 0; }

.re-grid > .re-col:first-child{ padding-right: .75rem; }
.re-grid > .re-col:last-child{  padding-left:  .75rem; }
.re-col{
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
 column-gap: var(--field-gap-x) !important;
  row-gap: var(--field-gap-y) !important;
}
  .re-col .full { grid-column:1 / -1; }
  .re-form label { display:block; font-size:.85rem; color:var(--muted); margin-bottom:.4rem; }
  .re-form input {
    width:100%; padding:.45rem .6rem; border-radius:10px;
    border:1px solid var(--border); outline:none; background:#fff; color:#111;
  }
  .re-form input:focus { border-color:var(--brand); box-shadow:0 0 0 3px rgba(47,112,200,.12); }
  .re-form input:disabled { opacity:.7; background:#fafafa; }

  /* Topbar above table (unchanged, slight polish) */
  .topbar { display:flex; gap:.75rem; align-items:center; flex-wrap:wrap; margin:.25rem 0 .5rem; }
  .topbar .spacer { flex:1; }
  .chip { border:1px solid var(--border); padding:.25rem .5rem; border-radius:999px; cursor:pointer; user-select:none; }
  .chip.active { background:rgba(47,112,200,.08); border-color:#b9d4ff; }

  .table.related-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1.25rem;
    background: #fff;
    border-radius: 1rem;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(15,26,58,0.05);
  }
  .table.related-table th,
  .table.related-table td {
    border: 1px solid #dfe3ea;
    padding: 0.65rem 0.75rem;
    font-size: 0.92rem;
  }
  .table.related-table th {
    background:#f7f9fc;
    font-weight:600;
    color:#0f172a;
    text-transform:uppercase;
    font-size:0.8rem;
    letter-spacing:0.04em;
  }
  .related-table tbody tr:nth-child(even) { background:#fbfcff; }
  .table.related-table tbody tr:hover { background:#eef4ff; }
  .table.related-table .table-icon-col {
    width:70px;
    padding:0.45rem 0.4rem;
  }
  .table-action-buttons {
    display:inline-flex;
    align-items:center;
    gap:0.3rem;
  }
  .table-icon-btn {
    border:none;
    background:transparent;
    padding:0.15rem;
    border-radius:0.35rem;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    transition:background-color 0.2s ease, transform 0.2s ease;
    cursor:pointer;
  }
  .table-icon-btn img {
    width:14px;
    height:14px;
    display:block;
  }
.table-icon-btn:hover,
.table-icon-btn:focus-visible {
    background:rgba(47,112,200,0.12);
    transform:translateY(-1px);
    outline:none;
  }
  #todo-panel[data-context="realtor"] .todo-automation {
    display:none;
  }

  @media (max-width: 720px) {
  .re-grid { grid-template-columns: 1fr; }
  .re-col  { grid-template-columns: 1fr; }
}

.task-drawer {
  position: fixed;
  top: 64px;
  right: 0;
  height: calc(100vh - 64px);
  width: 340px;
  max-width: 90vw;
  background: #fff;
  box-shadow: -16px 0 30px rgba(15, 26, 58, 0.12);
  transform: translateX(110%);
  transition: transform 0.3s ease;
  z-index: 999;
}

body.task-panel-open .task-drawer {
  transform: translateX(0);
}

.task-drawer-backdrop {
  position: fixed;
  top: 64px;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(15, 26, 58, 0.35);
  z-index: 998;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

body.task-panel-open .task-drawer-backdrop {
  opacity: 1;
  pointer-events: auto;
}

.task-drawer-contact {
  font-size: 0.85rem;
  color: #475467;
}
.task-drawer .task-drawer-header{
  justify-content:flex-start;
}
.task-drawer .task-drawer-header .todo-toggle{
  display:none;
}

.todo-close {
  border: none;
  background: transparent;
  font-size: 1.25rem;
  line-height: 1;
  cursor: pointer;
  color: #0f172a;
}

</style>
</head>
<body data-current-user-id="<%= currentUser ? currentUser.id : '' %>">
  <%- include('../partials/nav') %>
<%- include('../partials/top-nav-contacts') %>

<div class="container main-content">
  <div class="realtor-shell">

    <!-- Collapsed Identity Card -->
    <section class="realtor-identity">
      <div class="re-compact">
        <div class="re-cta re-cta--left">
          <div id="realtorActionButtons" class="table-action-buttons re-actions" aria-label="Realtor quick actions">
            <button class="table-icon-btn" type="button" data-action="task" aria-label="Manage realtor tasks">
              <img src="/assets/icons/add_task.svg" alt="">
            </button>
            <button class="table-icon-btn" type="button" data-action="flag" aria-label="Flag this realtor">
              <img src="/assets/icons/exclamation.svg" alt="">
            </button>
            <button class="table-icon-btn" type="button" data-action="comment" aria-label="Comment on this realtor">
              <img src="/assets/icons/comment.svg" alt="">
            </button>
          </div>
        </div>
        <div class="re-main">
          <div class="re-name">
            <span id="hdrName">REALTOR NAME</span>
            <span class="re-broker-inline" id="hdrBrokerage"></span>
          </div>
          <div class="re-contact">
            <a id="hdrPhone" href="#">Phone Number</a>
            <a id="hdrEmail" href="#">Email</a>
          </div>
        </div>
        <div class="re-cta">
          <button id="toggleEdit" class="btn-ghost">More Details</button>
        </div>
      </div>
    </section>

    <!-- Expanded Editor (hidden by default) -->
    <section id="editorCard" class="re-editor is-hidden">
      <div class="re-title" id="titleName">REALTOR NAME</div>

      <form id="realtorForm" class="re-form">
        <input type="hidden" id="realtorId" />

        <div class="re-grid">
          <!-- Left column: name/phone/email/license -->
          <div class="re-col">
              <div>
                <label>First Name</label>
                <input type="text" id="realtorFirstName" data-field="firstName" />
              </div>
              <div>
                <label>Last Name</label>
                <input type="text" id="realtorLastName" data-field="lastName" />
              </div>

              <div>
                <label>Phone</label>
                <input type="text" id="realtorPhone" data-field="phone" />
              </div>
              <div>
                <label>Email</label>
                <input type="email" id="realtorEmail" data-field="email" />
              </div>

              <div>
                <label>License #</label>
                <input type="text" id="realtorLicenseNumber" data-field="licenseNumber" />
              </div>
              <div>
                <label>Brokerage</label>
                <input type="text" id="realtorBrokerage" data-field="brokerage" />
              </div>
            </div>

          <!-- Right column: brokerage address block -->
          <div class="re-col">
            <div class="full">
              <label>Brokerage Address</label>
              <input type="text" id="realtorBrokerageAddress" data-field="brokerageAddress" />
            </div>
            <div>
              <label>Brokerage City</label>
              <input type="text" id="realtorBrokerageCity" data-field="brokerageCity" />
            </div>
            <div>
              <label>Brokerage State</label>
              <input type="text" id="realtorBrokerageState" data-field="brokerageState" />
            </div>
            <div class="full">
              <label>Brokerage Zip</label>
              <input type="text" id="realtorBrokerageZip" data-field="brokerageZip" />
            </div>
          </div>
        </div>

      </form>
    </section>

    <!-- Related Contacts table card -->
   <div id="realtorTopBar" class="contact-topbar">
  <div class="topbar-left">
    <label for="communitySelect" class="visually-hidden">Community</label>
    <select id="communitySelect" class="form-select form-select-sm">
      <!-- populated by JS -->
    </select>

    <div class="topbar-total">
      <span class="total-label">Total:</span>
      <span id="countTotal" class="total-value">0</span>
    </div>
  </div>

  <!-- Status pills container (two groups; we swap them with the More button) -->
  <div class="topbar-filters" id="statusFilters">
    <!-- MAIN GROUP (default visible) -->
    <div id="statusGroupMain">
      <button class="status-pill active" data-status="all">
        <span class="label">All</span>
        <span class="value" data-count="all">0</span>
      </button>
      <button class="status-pill" data-status="new">
        <span class="label">New</span>
        <span class="value" data-count="new">0</span>
      </button>
      <button class="status-pill" data-status="target">
        <span class="label">Target</span>
        <span class="value" data-count="target">0</span>
      </button>
      <button class="status-pill" data-status="possible">
        <span class="label">Possible</span>
        <span class="value" data-count="possible">0</span>
      </button>
      <button class="status-pill" data-status="negotiation">
        <span class="label">Negotiation</span>
        <span class="value" data-count="negotiation">0</span>
      </button>
      <button class="status-pill" data-status="be-back">
        <span class="label">Be-Back</span>
        <span class="value" data-count="be-back">0</span>
      </button>
      <button class="status-pill" data-status="purchased">
        <span class="label">Purchased</span>
        <span class="value" data-count="purchased">0</span>
      </button>
      <button class="status-pill" data-status="closed">
        <span class="label">Closed</span>
        <span class="value" data-count="closed">0</span>
      </button>
      <button class="status-pill" data-status="deal-lost">
        <span class="label">Deal-Lost</span>
        <span class="value" data-count="deal-lost">0</span>
      </button>
    </div>

    <!-- MORE GROUP (hidden until you click More) -->
    <div id="statusGroupMore" class="d-none">
      <button class="status-pill active" data-status="all">
        <span class="label">All</span>
        <span class="value" data-count="all">0</span>
      </button>
      <button class="status-pill" data-status="cold">
        <span class="label">Cold</span>
        <span class="value" data-count="cold">0</span>
      </button>
      <button class="status-pill" data-status="bust">
        <span class="label">Bust</span>
        <span class="value" data-count="bust">0</span>
      </button>
      <button class="status-pill" data-status="not-interested">
        <span class="label">Not-Interested</span>
        <span class="value" data-count="not-interested">0</span>
      </button>
    </div>
  </div>

  <!-- Right-side controls -->
  <button id="toggleFilterMode" class="btn btn-sm btn-outline-secondary">More</button>
  <button id="resetFilters" class="btn btn-sm btn-outline-secondary">Reset</button>
</div>

      <table class="table related-table">
        <thead>
          <tr>
            <th class="contact-table-icons"></th>
            <th>Name</th><th>Phone</th><th>Email</th>
            <th>Status</th><th>Communities</th><th>Owner</th>
          </tr>
        </thead>
        <tbody id="relatedContactsBody" class="relatedContactBody"></tbody>
      </table>
    </div>

  </div>
</div>

<!-- Realtor Comment Modal -->
<div id="commentModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h5>Add Comment</h5>

    <div class="comment-type-nav" id="modal-comment-type-buttons">
      <button type="button" data-type="Note" class="active" title="Note">
        <img src="/assets/icons/note.svg" alt="Note" />
      </button>
      <button type="button" data-type="Phone" title="Phone">
        <img src="/assets/icons/phone.svg" alt="Phone" />
      </button>
      <button type="button" data-type="Email" title="Email">
        <img src="/assets/icons/email.svg" alt="Email" />
      </button>
      <button type="button" data-type="Text" title="Text">
        <img src="/assets/icons/sms.svg" alt="Text" />
      </button>
    </div>

    <textarea id="modal-comment-text" rows="4" placeholder="Add a comment..."></textarea>
    <br />
    <button id="saveModalComment" class="btn btn-primary btn-sm">Save</button>
    <button id="cancelModalComment" class="btn btn-secondary btn-sm">Cancel</button>
  </div>
</div>

<div id="task-drawer-backdrop" class="task-drawer-backdrop" hidden></div>
<aside id="todo-panel" class="todo-panel task-drawer" aria-live="polite" hidden>
    <header class="todo-header">
      <div class="task-drawer-header">
        <button id="todo-toggle" class="todo-toggle" type="button" aria-expanded="true">
          <span class="todo-toggle-icon" aria-hidden="true">&#9662;</span>
          <span class="todo-toggle-text">Tasks</span>
          <span id="todo-count" class="todo-count">0</span>
        </button>
        <button type="button" class="todo-close" data-task-drawer-close aria-label="Close task drawer">&times;</button>
      </div>
      <div class="task-drawer-contact" id="task-panel-contact-name"></div>
      <button id="todo-add" class="todo-add-btn" type="button">
        <img src="/assets/icons/add_task.svg" alt="" aria-hidden="true" />
        <span>Add Task</span>
      </button>
    </header>
    <section id="todo-panel-body" class="todo-body">
      <div class="todo-summary">
        <button type="button" class="todo-pill is-active" data-filter="all">
          <span class="pill-label">All</span>
          <span class="pill-count" aria-hidden="true">0</span>
        </button>
        <button type="button" class="todo-pill" data-filter="Pending">
          <span class="pill-label">Pending</span>
          <span class="pill-count" aria-hidden="true">0</span>
        </button>
        <button type="button" class="todo-pill" data-filter="Completed">
          <span class="pill-label">Completed</span>
          <span class="pill-count" aria-hidden="true">0</span>
        </button>
      </div>

      <section class="todo-automation" data-followup-schedule>
        <div class="todo-automation-text">
          <p class="todo-automation-title">Follow-up schedule</p>
          <p class="todo-automation-body">Use your saved cadence to auto-create the next touchpoints for this contact.</p>
        </div>
        <div class="todo-automation-controls">
          <select
            id="followup-schedule-select"
            class="todo-automation-select"
            data-followup-select
            aria-label="Select a follow-up schedule"
            disabled>
            <option value="">Loading schedules...</option>
          </select>
          <button type="button" class="todo-automation-button" data-followup-apply disabled>Assign</button>
        </div>
        <div class="todo-automation-active" data-followup-active hidden>
          <div class="todo-automation-active-copy">
            <p class="todo-automation-active-label">Current schedule</p>
            <p class="todo-automation-active-name" data-followup-active-name>—</p>
            <p class="todo-automation-active-meta" data-followup-active-meta></p>
          </div>
          <button type="button" class="todo-automation-unassign" data-followup-unassign>Unassign</button>
        </div>
        <p class="todo-automation-status" data-followup-status aria-live="polite" hidden></p>
      </section>

      <ul id="todo-list" class="todo-list">
        <li class="todo-empty">
          <div class="todo-empty-state">
            <img src="/assets/icons/add_task.svg" alt="" aria-hidden="true" />
            <p class="todo-empty-text">No tasks yet. Add one to keep this contact moving forward.</p>
          </div>
        </li>
      </ul>
      <footer class="todo-footer">
        <button id="todo-view-all" class="todo-view-all-btn" type="button">View All Tasks</button>
      </footer>
    </section>
  </aside>

  <div id="task-modal" class="task-modal" aria-hidden="true" hidden>
    <div class="task-modal__backdrop" data-task-modal-close></div>
    <div class="task-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="task-modal-title">
      <header class="task-modal__header">
        <h2 id="task-modal-title">Edit Task</h2>
        <button type="button" id="task-modal-close" class="task-modal__close" aria-label="Close task editor">&times;</button>
      </header>
      <form id="task-modal-form" class="task-modal__form" novalidate>
        <div class="task-modal__content">
          <div class="task-modal__row">
            <label for="task-modal-title-input">Title</label>
            <input id="task-modal-title-input" name="title" type="text" maxlength="160" required />
          </div>
          <div class="task-modal__row">
            <span class="task-modal__row-label">Task Type</span>
            <div id="task-type-buttons" class="task-type-group" role="group" aria-label="Task type">
              <button type="button" class="task-type-button is-selected" data-type="Follow-Up" aria-pressed="true">Follow-Up</button>
              <button type="button" class="task-type-button" data-type="Document" aria-pressed="false">Document</button>
              <button type="button" class="task-type-button" data-type="Approval" aria-pressed="false">Approval</button>
              <button type="button" class="task-type-button" data-type="Review" aria-pressed="false">Review</button>
              <button type="button" class="task-type-button" data-type="Custom" aria-pressed="false">Custom</button>
            </div>
            <div id="task-followup-sub" class="task-type-subgroup" hidden aria-hidden="true">
              <span class="task-type-subtitle">Follow-Up via</span>
              <div class="task-type-subbuttons" role="group" aria-label="Follow-up method">
                <button type="button" class="task-type-subbutton is-selected" data-followup="Follow-Up" aria-pressed="true">General</button>
                <button type="button" class="task-type-subbutton" data-followup="Call" aria-pressed="false">Call</button>
                <button type="button" class="task-type-subbutton" data-followup="Email" aria-pressed="false">Email</button>
                <button type="button" class="task-type-subbutton" data-followup="Meeting" aria-pressed="false">Meeting</button>
              </div>
            </div>
          </div>
          <div class="task-modal__grid two-col">
            <div class="task-modal__row">
              <label for="task-modal-priority">Priority</label>
              <select id="task-modal-priority" name="priority"></select>
            </div>
            <div class="task-modal__row">
              <label for="task-modal-category">Category</label>
              <select id="task-modal-category" name="category"></select>
            </div>
          </div>
          <div class="task-modal__grid two-col">
            <div class="task-modal__row">
              <label for="task-modal-due">Due date</label>
              <input id="task-modal-due" name="dueDate" type="date" />
            </div>
            <div class="task-modal__row">
              <label for="task-modal-status">Status</label>
              <select id="task-modal-status" name="status"></select>
            </div>
          </div>
          <div class="task-modal__row">
            <label for="task-modal-reminder-date">Reminder (optional)</label>
            <div class="task-modal__reminder-grid">
              <input id="task-modal-reminder-date" name="reminderDate" type="date" />
              <input id="task-modal-reminder-time" name="reminderTime" type="time" />
            </div>
            <p class="task-modal__hint">Pick a date and time to get nudged about this task.</p>
          </div>
          <div class="task-modal__row">
            <label for="task-modal-notes">Notes</label>
            <textarea id="task-modal-notes" name="description" rows="4" maxlength="2000"></textarea>
          </div>
        </div>
        <p id="task-modal-error" class="task-modal__error" role="alert" hidden></p>
        <div class="task-modal__actions">
          <div class="task-modal__actions-left">
            <button type="button" id="task-modal-complete" class="task-modal__secondary">Mark as Completed</button>
          </div>
          <div class="task-modal__actions-right">
            <button type="button" id="task-modal-cancel" class="task-modal__secondary">Cancel</button>
            <button type="submit" id="task-modal-save" class="task-modal__primary">Save Changes</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script type="module" src="/assets/js/pages/realtor-details/index.js"></script>
</body>
</html>
