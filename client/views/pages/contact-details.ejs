<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Contact Details</title>
  <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>

  <div id="contact-details-root"
    data-contact-id="<%= contact._id %>"
    data-initial-status="<%= contact.status %>">
  </div>

  <%- include('../partials/nav') %>
  <%- include('../partials/top-nav-contacts') %>
<div class="page-wrapper">
  <main class="contact-content">
  <form id="contactForm">
    <div class="horizontal-cont">
      <div class="card .card--grey main-cont">

        <!-- Deal Info -->
        <div class="card card--white deal-info">
          <div class="form-group">
            <label for="owner">Owner</label>
            <input type="text" id="owner" />
          </div>
          <div class="form-group">
            <label for="community-select">Community</label>
              <select id="community-select" class="select-standard">
                <option value="">-- Select Community --</option>
                <!-- dynamically filled -->
              </select>
              <input type="hidden" id="communities" />
          </div>
          <div class="form-group">
            <label for="visit-date">Visit Date</label>
            <input type="text" id="visit-date"  value="<%= contact && contact.visitDate ? new Date(contact.visitDate).toISOString().slice(0,10) : '' %>"/>
          </div>
        </div>

        <!-- Customer Info -->
        <div class="card card--white cus-info-container">
            <div class="form-group">
              <div class="status-cont">
                <label for="status">Status</label>
                  <select name="status" id="status" class="select-standard" >
                    <option value="new">New</option>
                    <option value="be-back">Be-Back</option>
                    <option value="cold">Cold</option>
                    <option value="target">Target</option>
                    <option value="possible">Possible</option>
                    <option value="negotiating">Negotiating</option>
                    <option value="purchased">Purchased</option>
                    <option value="closed">Closed</option>
                    <option value="not-interested">Not-Interested</option>
                    <option value="deal-lost">Deal-Lost</option>
                    <option value="bust">Bust</option>
                  </select>
              </div>
            </div>

            <div class="form-group">
              <label for="firstName">First Name</label>
              <input type="text" id="firstName" />
            </div>
            <div class="form-group">
              <label for="lastName">Last Name</label>
              <input type="text" id="lastName" />
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" id="email" />
            </div>
            <div class="form-group">
              <label for="phone">Phone</label>
              <input type="text" id="phone" />
            </div>
            <div class="form-group">
              <label for="source">Lead Source</label>
              <select name="source" id="source" class="select-standard select-center">
                <option value="phone-lead">Phone</option>
                <option value="email-lead">Email</option>
                <option value="online-lead">Online</option>
                <option value="walk-in-lead">Walk-In</option>
              </select>
            </div>
          
              <!-- ✱ NEW: collapsible panel toggle bar -->
              <div id="more-info-panel" class="collapsed">
                <div id="more-info-toggle">
                  <div class="toggle-inner">
                    <span class="triangle">▶</span>
                    <span class="toggle-text">More Details</span>
                  </div>
                </div>
                <div id="more-info-body">

                  <!-- A: inputs group -->
                  <div class="inputs-group">
                    <div class="form-group">
                      <label for="lotLineUp">Lot Line Up</label>
                      <input type="text" id="lotLineUp" />
                    </div>
                    <div class="form-group">
                      <label for="buyTime">Buy Time</label>
                      <input type="text" id="buyTime" />
                    </div>
                    <div class="form-group">
                      <label for="buyMonth">Buy Month</label>
                      <input type="text" id="buyMonth" />
                    </div>
                  </div>

                  <!-- B: floorplans group -->
                  <div class="floorplans-group">
                    <label for="floorplans">Floor Plans</label>
                    <div id="floorplans-container" class="option-group no-auto">…</div>
                  </div>

                  <!-- C: facing group (spans both columns) -->
                  <div class="facing-group">
                    <label for="facing">Lot Facing</label>
                    <div class="option-group no-auto">
                      <label><input type="checkbox" name="facing" value="North" /> North</label>
                      <label><input type="checkbox" name="facing" value="South" /> South</label>
                      <label><input type="checkbox" name="facing" value="East"  /> East</label>
                      <label><input type="checkbox" name="facing" value="West"  /> West</label>
                      <label class="any-option"><input type="checkbox" name="facing" value="Any"   /> Any</label>
                    </div>
                  </div>

                  <!-- D: living-condition group (also spans both) -->
                  <div class="living-group">
                    <label for="miscInfo">Living Condition</label>
                    <div class="option-group no-auto">
                      <label><input type="checkbox" id="investor"> Investor</label>
                      <label><input type="checkbox" id="renting"> Renting</label>
                      <label><input type="checkbox" id="own-selling"> Own &amp; Selling</label>
                      <label><input type="checkbox" id="own-not-selling"> Own &amp; Not Selling</label>
                    </div>
                  </div>

                </div>
              </div>
          </div>

        <!-- Realtor Info -->
        <div class="card card--white realtor-container">
          <div class="form-group">
            <label for="realtor-search">Search Realtor</label>
            <input type="text" id="realtor-search" placeholder="Search by name, email, or phone" />
            <div id="realtor-search-results" class="search-results"></div>
          </div>
          <div class="form-group">
            <label for="realtorFirstName">First Name</label>
            <input type="text" id="realtorFirstName" />
          </div>
          <div class="form-group">
            <label for="realtorLastName">Last Name</label>
            <input type="text" id="realtorLastName" />
          </div>
          <div class="form-group">
            <label for="realtorPhone">Phone</label>
            <input type="text" id="realtorPhone" />
          </div>
          <div class="form-group">
            <label for="realtorEmail">Email</label>
            <input type="email" id="realtorEmail" />
          </div>
          <div class="form-group">
            <label for="realtorBrokerage">Brokerage</label>
            <input type="text" id="realtorBrokerage" />
          </div>
        </div>

      <div class="lender-cont">
          <!-- Lender Info -->
        <form class="lender-form">
          <div class="lender-search-container">

<!-- ===== LENDER SEARCH BLOCK ===== -->
      <section id="lender-link-section" class="lender-link-card">
        <h3 class="lender-link-title">Link a Lender</h3>

        <!-- Search input -->
        <div class="form-group">
          <input
            id="lender-search-input"
            type="text"
            placeholder="Search lenders by name, email, or phone"
          />
        </div>

        <div id="lender-search-results" class="search-results"></div>

        <!-- Auto-filled fields -->
        <div id="lender-info-fields" class="lender-info" style="display:none;">
          <div class="form-pair">
            <label>First Name</label>
            <input id="lender-firstName" readonly />
          </div>
          <div class="form-pair">
            <label>Last Name</label>
            <input id="lender-lastName" readonly />
          </div>
          <div class="form-pair">
            <label>Email</label>
            <input id="lender-email" readonly />
          </div>
          <div class="form-pair">
            <label>Phone</label>
            <input id="lender-phone" readonly />
          </div>
          <div class="form-pair">
            <label>Brokerage</label>
            <input id="lender-brokerage" readonly />
          </div>
          <div class="form-actions">
            <button id="lender-link-btn" type="button" disabled>
              Link to Contact
            </button>
          </div>
        </div>
      </section>
      <!-- ===== END SEARCH BLOCK ===== -->

    <!-- ===== LINKED LENDERS DISPLAY ===== -->
            <section id="linked-lenders-section">
              <h3>Linked Lenders</h3>
              <div id="lender-list-container"></div>
            </section>
    <!-- ===== END LINKED LENDERS DISPLAY ===== -->
          </div>
        </form>
      </div>
      
</div>

        
     

    <!-- Top Container -->
    <div class="top-comment-cont">
      <div class="card card--grey top-container">
          <div class="disc-cont">
            <div id="contact-full-name" class="contact-name">Full Name</div>
            <div id="contact-status-badge" class="status-badge">Status</div>
          </div>
        <div class="bottom-cont">
          <div class="all-status-cont">
            <!--upto 3 lenders here-->
          </div>
        <div id="community-section">
          <div class="com-left-cont">
            <div id="community-summary" class="community-grid">

              <!-- Top: Lot Line Up (full width) -->
              <section class="card-block lot-line">
                <div class="block-label">Lot Line Up</div>
                <div class="block-value" id="summary-lotLineUp">—</div>
              </section>

              <!-- Middle left: Floor Plans -->
              <section class="card-block floorplans-block">
                <div class="block-label">Floor Plans</div>
                <div class="block-value" id="summary-floorplans">—</div>
              </section>

              <!-- Middle right: Facing -->
              <section class="card-block facing-block">
                <div class="block-label">Facing</div>
                <div class="block-value" id="summary-facing">—</div>
              </section>

              <!-- Bottom left: Buy Time + Buy Month (stacked) -->
              <section class="card-block buy-block">
                <div class="sub-block">
                  <div class="block-label">Buy Time</div>
                  <div class="block-value" id="summary-buyTime">—</div>
                </div>
                <div class="sub-block">
                  <div class="block-label">Buy Month</div>
                  <div class="block-value" id="summary-buyMonth">—</div>
                </div>
              </section>

              <!-- Bottom right: Living Condition -->
              <section class="card-block living-block">
                <div class="block-label">Living Condition</div>
                <div class="block-value" id="summary-living">—</div>
              </section>

            </div>
          </div>
        </div>
                        <!--Purchaser Box-->
            <div id="lot-link-container">
                <div id="purchased-community-selector" style="display: none;">
                  <label for="lot-search">Search for Lot Address</label>
                  <input type="text" id="lot-search" placeholder="Start typing an address..." />
                  <div id="lot-search-results" class="search-results"></div>
                  <button id="link-lot-btn" disabled>Link Lot to Contact</button>
                </div>
                   <!-- NEW: Sales details captured at link time -->
               <div id="sales-details" class="form-row" style="margin-top:.5rem; display:none;">
                <div class="form-group">
                  <label for="sale-date">Sales Date</label>
                  <input type="date" id="sale-date" />
                </div>
                <div class="form-group">
                  <label for="sale-price">Sales Price</label>
                  <input type="number" id="sale-price" placeholder="e.g. 435000" step="0.01" inputmode="decimal" />
                </div>
              </div>
            </div>

            

            <!-- This will show the linked lot info once it's connected -->
            <div id="linked-lot-display" style="display: none;"></div>
        
      </div>
    </div>

    <div class="comment-section">
      <h3>Comments</h3>
  
      <div class="comment-form">
        <div class="comment-type-nav" id="comment-type-buttons">
          <button type="button" data-type="Note" class="active" title="Note"><img src="/assets/icons/note.svg" alt=""></button>
          <button type="button" data-type="Phone" title="Phone"><img src="/assets/icons/phone.svg" alt=""></button>
          <button type="button" data-type="Email" title="Email"><img src="/assets/icons/email.svg" alt=""></button>
          <button type="button" data-type="Text" title="Text"><img src="/assets/icons/sms.svg" alt=""></button>
        </div>
        <textarea id="comment-text" placeholder="Add a comment..."></textarea>
        <button id="save-comment" type="button">Save Comment</button>
      </div>

      <div id="comment-history"></div>
      </div>
  </form>
</div>
</div>
</main>
<aside id="todo-panel" class="todo-panel">
    <header class="todo-header">
      <button id="todo-toggle" class="todo-toggle">▸ Tasks</button>
    </header>
    <div class="todo-body">
      <!-- Placeholder for future tasks -->
      <p>No tasks yet.</p>
    </div>
  </aside>
</div>

<script type="module" src="/assets/js/contact-details/index.js"></script>

</body>
</html>