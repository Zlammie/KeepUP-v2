<!-- CAN DELETE THIS PAGE NOW NO LONGER USED-->
<!--
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Communities</title>
  <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>
 <%- include('../partials/nav') %>
  <%- include('../partials/top-nav-community') %>

  <div class="table-container">
  <table id="communitiesTable">
    <thead>
      <tr>
        <th>Community</th>
        <th>Project #</th>
        <th>Lot Count</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="communitiesTableBody"></tbody>
  </table>
</div>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const tbody = document.getElementById('communitiesTableBody');
    const esc = s => String(s ?? '').replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));

    try {
      const res = await fetch('/api/communities'); // your existing index route
      if (!res.ok) throw new Error(`Server returned ${res.status}`);
      const communities = await res.json();

      if (!Array.isArray(communities) || !communities.length) {
        tbody.innerHTML = '<tr><td colspan="4" class="text-muted">No communities yet</td></tr>';
        return;
      }

      tbody.innerHTML = communities.map(c => {
        const lotCount = Array.isArray(c.lots) ? c.lots.length : (c.lotsCount ?? 0);
        return `
          <tr>
            <td>${esc(c.name)}</td>
            <td>${esc(c.projectNumber || '')}</td>
            <td>${lotCount}</td>
            <td>
              <a class="btn btn-sm btn-outline" href="/view-lots?communityId=${esc(c._id)}">View Lots</a>
            </td>
          </tr>
        `;
      }).join('');
    } catch (err) {
      console.error('Failed to load communities:', err);
      tbody.innerHTML = `<tr><td colspan="4" class="text-danger">Failed to load communities</td></tr>`;
    }
  });
</script>


</body>
</html>
-->
