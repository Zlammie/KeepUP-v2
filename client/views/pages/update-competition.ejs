<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Update Competition</title>
   <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="/assets/css/main.css">
  
</head>
<body data-competition-id="<%= competition._id %>">

<%- include('../partials/nav') %>
<%- include('../partials/top-nav-competition') %>

<div class="horizontal-cont">
  <div class="side-bar card card--grey main-cont">
     <div class="card card--white">

      <button id="backToDetailsBtn" class="btn btn-outline-secondary btn-sm">
        ← Back to Details
      </button>

      <!-- Script (module) -->
   
          <div class="card-header">
            Competition Info
          </div>
          <div class="card-body">
            <h5 class="card-title"><%= competition.communityName %></h5>
            <p class="card-text">
              Builder: <strong><%= competition.builderName %></strong>
            </p>
          </div>
      </div>
          <!-- Add / Update Floor Plans button -->
      <button 
        id="openPlanModal"
        type="button"
        class="btn btn-secondary mb-3"
        data-bs-toggle="modal"
        data-bs-target="#floorPlanModal"
      >
        Add / Update Floor Plans
      </button>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
      <!-- Floor Plans Modal -->
      <div
        class="modal fade"
        id="floorPlanModal"
        tabindex="-1"
        aria-labelledby="floorPlanModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <form id="floorPlanForm">
              <div class="modal-header">
                <h5 class="modal-title" id="floorPlanModalLabel">
                  Floor Plans
                </h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <!-- existing floor plans list -->
                <div id="floorPlanList" class="list-group mb-4"></div>

                <!-- floor plan form fields -->
                <input type="hidden" id="fpId" name="id" />
                <div class="mb-3">
                  <label for="fpName" class="form-label">Floor Plan Name</label>
                  <input
                    type="text"
                    id="fpName"
                    name="name"
                    class="form-control"
                    required
                  />
                </div>
                <div class="row">
                  <div class="col-md-4 mb-3">
                    <label for="fpSqft" class="form-label">Sqft</label>
                    <input
                      type="number"
                      id="fpSqft"
                      name="sqft"
                      class="form-control"
                    />
                  </div>
                  <div class="col-md-4 mb-3">
                    <label for="fpBed" class="form-label">Bed</label>
                    <input
                      type="number"
                      id="fpBed"
                      name="bed"
                      class="form-control"
                    />
                  </div>
                  <div class="col-md-4 mb-3">
                    <label for="fpBath" class="form-label">Bath</label>
                    <input
                      type="number"
                      id="fpBath"
                      name="bath"
                      class="form-control"
                      step="any"
                      min="0"  
                    />
                  </div>
                  <div class="col-md-4 mb-3">
                    <label for="fpGarage" class="form-label">Garage</label>
                    <input
                      type="number"
                      id="fpGarage"
                      name="garage"
                      class="form-control"
                    />
                  </div>
                  <div class="col-md-4 mb-3">
                    <label for="fpStory" class="form-label">Story Type</label>
                    <select
                      id="fpStory"
                      name="storyType"
                      class="form-select"
                      required
                    >
                      <option value="Single">Single Story</option>
                      <option value="Two">Two Story</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">
                  Save Floor Plan
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Close
                </button>
              </div>
            </form>
          </div>
        </div>
      </div> 
      <div class="card card--white task-panel-card">
        <div
          id="todo-panel"
          class="todo-panel"
          aria-live="polite"
          data-default-title="Follow up on <%= competition.builderName %> &ndash; <%= competition.communityName %>"
        >
          <header class="todo-header">
            <button id="todo-toggle" class="todo-toggle" type="button" aria-expanded="true">
              <span class="todo-toggle-icon" aria-hidden="true">&#9662;</span>
              <span class="todo-toggle-text">Tasks</span>
              <span id="todo-count" class="todo-count">0</span>
            </button>
            <button id="todo-add" class="todo-add-btn" type="button">
              <img src="/assets/icons/add_task.svg" alt="" aria-hidden="true" />
              <span>Add Task</span>
            </button>
          </header>

          <section id="todo-panel-body" class="todo-body">
            <div class="todo-summary">
              <button type="button" class="todo-pill is-active" data-filter="all">
                <span class="pill-label">All</span>
                <span class="pill-count" aria-hidden="true">0</span>
              </button>
              <button type="button" class="todo-pill" data-filter="Pending">
                <span class="pill-label">Pending</span>
                <span class="pill-count" aria-hidden="true">0</span>
              </button>
              <button type="button" class="todo-pill" data-filter="Completed">
                <span class="pill-label">Completed</span>
                <span class="pill-count" aria-hidden="true">0</span>
              </button>
            </div>

            <div class="todo-helper">
              <p class="todo-helper-title">Keep this competition up to date</p>
              <p class="todo-helper-body">
                Track reminders tied to <%= competition.builderName %> – <%= competition.communityName %>.
              </p>
            </div>

            <ul id="todo-list" class="todo-list">
              <li class="todo-empty">
                <div class="todo-empty-state">
                  <img src="/assets/icons/add_task.svg" alt="" aria-hidden="true" />
                  <p class="todo-empty-text">Select a task to view details or add a new one.</p>
                </div>
              </li>
            </ul>
            <footer class="todo-footer">
              <button id="todo-view-all" class="todo-view-all-btn" type="button">View All Tasks</button>
            </footer>
          </section>
        </div>
      </div> 
  </div>
   <main class="container mt-0">
    
           <nav class="month-nav-container mt-3">
            <div class="d-flex overflow-auto">
             <ul id="monthNav" class="nav nav-pills flex-nowrap mb-3"></ul>
            </div>
                <!-- ───────── section tabs ───────── -->
              <ul id="sectionNav" class="nav folder-tabs">
                 <li class="nav-item">
                    <a class="nav-link active" href="#" data-section="metrics">Metrics</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="#" data-section="price">Floor Plans</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#" data-section="inventory">Inventory</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#" data-section="sales">Sales</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#" data-section="notes">Notes</a>
                </li>
              </ul>
            </nav>
            <!-- ───────── Metrics Section ───────── -->
            <div class="section d-none" data-section-content="metrics">
              <h3 class="mt-5">Community Metrics</h3>
              <div class="container mt-3">
                <form id="metricsForm">
                  <div class="mb-3">
                    <label for="promotion" class="form-label">Promotion</label>
                     <textarea
                        id="promotion"
                        name="promotion"
                        data-metrics
                        class="form-control"
                        rows="3"
                      ><%= competition.promotion || '' %></textarea>
                  </div>
                  <!-- Top 3 Plans -->
                 <div class="mb-3 card">
                  <label class="form-label">Top 3 Plans</label>
                    <select name="topPlan1" id="topPlan1" class="form-select mb-2" data-metrics>
                      <option value="">1. Select Plan</option>
                    </select>
                    <select name="topPlan2" id="topPlan2" class="form-select mb-2" data-metrics>
                      <option value="">2. Select Plan</option>
                    </select>
                    <select name="topPlan3" id="topPlan3" class="form-select" data-metrics>
                      <option value="">3. Select Plan</option>
                    </select>
                </div>

                  <!-- Pros & Cons -->
                  <div class="mb-3 card">
                    <label class="form-label">Pros</label>
                    <div id="prosList" class="mb-2"></div>
                    <div class="input-group mb-2">
                      <input type="text" id="newPro" class="form-control" placeholder="Add a pro">
                      <button type="button" id="addProBtn" class="btn btn-outline-secondary">Add</button>
                    </div>

                    <label class="form-label">Cons</label>
                    <div id="consList" class="mb-2"></div>
                    <div class="input-group">
                      <input type="text" id="newCon" class="form-control" placeholder="Add a con">
                      <button type="button" id="addConBtn" class="btn btn-outline-secondary">Add</button>
                    </div>
                  </div>

                  <!-- Lot Counts (placeholders) -->
                  <div class="row card">
                    <div class="col-md-3 mb-3">
                      <label class="form-label">Lot Count</label>
                      <input type="number" name="totalLots" id="lotCount" class="form-control" readonly>
                    </div>
                    <div class="col-md-3 mb-3">
                      <label class="form-label">Sold Lots</label>
                      <input type="number" name="soldLots" id="soldLots" class="form-control">
                    </div>
                    <div class="col-md-3 mb-3">
                      <label class="form-label">Remaining Lots</label>
                      <input type="number" id="remainingLots" class="form-control" readonly>
                    </div>
                    <div class="col-md-3 mb-3">
                      <label class="form-label">Quick Move-In Lots</label>
                      <input type="number" name="quickMoveInLots" id="quickMoveInLots" class="form-control">
                    </div>
                  </div>
                </form>
              </div>
            </div>
            <div class="section" data-section-content="price">
               <div id="monthTableContainer" class="container mt-4">
                <table id="monthTable" class="table table-bordered">
                  <thead>
                    <tr>
                      <th>Floor Plan</th>
                      <th>Sqft</th>
                      <th>Bed</th>
                      <th>Bath</th>
                      <th>Garage</th>
                      <th>Story</th>
                      <th>Price</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
            <div class="section d-none" data-section-content="inventory">
              <h3 class="mt-5">Quick Move-In Homes</h3>
              <div id="quickHomesContainer" class="container mt-2">
                <table id="quickHomesTable" class="table table-bordered">
                  <thead>
                    <tr>
                      <th></th> <!-- Delete -->
                      <th>Address</th>
                      <th>List Date</th>
                      <th>Floor Plan</th>
                      <th>List Price</th>
                      <th>Sqft</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
              <h3 class="mt-5">Sold Homes</h3>
              <div id="soldHomesContainer" class="container mt-2">
                <table id="soldHomesTable" class="table table-bordered">
                  <thead>
                    <tr>
                      <th></th> <!-- Delete -->
                      <th>Address</th>
                      <th>List Date</th>
                      <th>Floor Plan</th>
                      <th>List Price</th>
                      <th>Sqft</th>
                      <th>Status</th>
                      <th>Sold Date</th>
                      <th>Sold Price</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
            <div class="section d-none" data-section-content="sales">
              <h3 class="mt-5">Sales Summary</h3>
              <div id="salesContainer" class="container mt-2">
                <table id="salesTable" class="table table-bordered">
                  <thead>
                    <tr>
                      <th>Month</th>
                      <th>Sales</th>
                      <th>Cancels</th>
                      <th>Net</th>
                      <th>Closings</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
            <div class="section d-none" data-section-content="notes">
             <h3 class="mt-5">Notes</h3>
              <div class="container mt-2">
                <textarea
                  id="notes"
                  name="notes"
                  class="form-control"
                  rows="5"
                  placeholder="Enter any notes here"
                ></textarea>
              </div>
            </div>
      </main>
</div>



 <script id="competition-data" type="application/json">
    <%- JSON.stringify({
      pros: competition.pros || [],
      cons: competition.cons || [],
      monthNames: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
      latestMetrics: (competition.monthlyMetrics || []).slice(-1)[0] || {},
      totalLots: competition.totalLots || 0,
      topPlan1: competition.topPlan1 || null,
      topPlan2: competition.topPlan2 || null,
      topPlan3: competition.topPlan3 || null,
      competitionId: competition._id,
      builderName: competition.builderName,
      communityName: competition.communityName
    }) %>
  </script>
<script nonce="<%= cspNonce %>">
  window.UPDATE_COMP_BOOT = window.UPDATE_COMP_BOOT || {};
  window.UPDATE_COMP_BOOT.defaultTaskTitle = 'Follow up on <%= competition.builderName %> – <%= competition.communityName %>';
</script>

  <div id="task-modal" class="task-modal" aria-hidden="true" hidden>
    <div class="task-modal__backdrop" data-task-modal-close></div>
    <div class="task-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="task-modal-title">
      <header class="task-modal__header">
        <h2 id="task-modal-title">Edit Task</h2>
        <button type="button" id="task-modal-close" class="task-modal__close" aria-label="Close task editor">&times;</button>
      </header>
      <form id="task-modal-form" class="task-modal__form" novalidate>
        <div class="task-modal__content">
          <div class="task-modal__row">
            <label for="task-modal-title-input">Title</label>
            <input id="task-modal-title-input" name="title" type="text" maxlength="160" required />
          </div>
          <div class="task-modal__row">
            <span class="task-modal__row-label">Task Type</span>
            <div id="task-type-buttons" class="task-type-group" role="group" aria-label="Task type">
              <button type="button" class="task-type-button is-selected" data-type="Follow-Up" aria-pressed="true">Follow-Up</button>
              <button type="button" class="task-type-button" data-type="Reminder" aria-pressed="false">Reminder</button>
              <button type="button" class="task-type-button" data-type="Document" aria-pressed="false">Document</button>
              <button type="button" class="task-type-button" data-type="Approval" aria-pressed="false">Approval</button>
              <button type="button" class="task-type-button" data-type="Review" aria-pressed="false">Review</button>
              <button type="button" class="task-type-button" data-type="Note" aria-pressed="false">Note</button>
              <button type="button" class="task-type-button" data-type="Custom" aria-pressed="false">Custom</button>
            </div>
            <div id="task-followup-sub" class="task-type-subgroup" hidden aria-hidden="true">
              <span class="task-type-subtitle">Follow-Up via</span>
              <div class="task-type-subbuttons" role="group" aria-label="Follow-up method">
                <button type="button" class="task-type-subbutton is-selected" data-followup="Follow-Up" aria-pressed="true">General</button>
                <button type="button" class="task-type-subbutton" data-followup="Call" aria-pressed="false">Call</button>
                <button type="button" class="task-type-subbutton" data-followup="Email" aria-pressed="false">Email</button>
                <button type="button" class="task-type-subbutton" data-followup="Meeting" aria-pressed="false">Meeting</button>
              </div>
            </div>
          </div>
          <div class="task-modal__grid two-col">
            <div class="task-modal__row">
              <label for="task-modal-due">Due date</label>
              <input id="task-modal-due" name="dueDate" type="date" />
            </div>
            <div class="task-modal__row">
              <label for="task-modal-priority">Priority</label>
              <select id="task-modal-priority" name="priority"></select>
            </div>
          </div>
          <div class="task-modal__grid two-col">
            <div class="task-modal__row">
              <label for="task-modal-status">Status</label>
              <select id="task-modal-status" name="status"></select>
            </div>
          </div>
          <div class="task-modal__row">
            <label for="task-modal-notes">Notes</label>
            <textarea id="task-modal-notes" name="description" rows="4" maxlength="2000"></textarea>
          </div>
        </div>
        <p id="task-modal-error" class="task-modal__error" role="alert" hidden></p>
        <div class="task-modal__actions">
          <div class="task-modal__actions-left">
            <button type="button" id="task-modal-complete" class="task-modal__secondary">Mark as Completed</button>
          </div>
          <div class="task-modal__actions-right">
            <button type="button" id="task-modal-cancel" class="task-modal__secondary">Cancel</button>
            <button type="submit" id="task-modal-save" class="task-modal__primary">Save Changes</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- 2) only one script tag to pull in your modules -->
  <script type="module" src="/assets/js/update-competition/init.js"></script>


  

</body>
</html>
