<!-- views/partials/navbar.html -->
<script nonce="<%= cspNonce %>">
  // Apply nav offsets and clear any stuck overlays once DOM is ready
  const __ku_clearOverlays = () => {
    document.body.classList.add('has-nav');
    document.body.classList.remove('task-panel-open', 'task-modal-open');
    document.querySelectorAll('.task-drawer-backdrop, .task-modal__backdrop').forEach((el) => {
      el.setAttribute('hidden', 'true');
      el.style.pointerEvents = 'none';
      el.style.opacity = '0';
    });
  };
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', __ku_clearOverlays, { once: true });
  } else {
    __ku_clearOverlays();
  }
</script>
<nav class="horizontalBar">
  <div class="top-left">
    <h1 class="nav-logo">Keep Up</h1>
  </div>
  <div class="top-center">
    <input type="text" placeholder="Search..." class="search-bar">
  </div>
  <div class="top-right">
    <a href="/toolbar/help"><button class="top-btn"><img src="/assets/icons/help.svg" alt="Help"></button></a>
    <% const canAccessAdmin = permissions && permissions.canAccessAdminSection; %>
    <% if (canAccessAdmin) { %>
      <button class="top-btn" type="button" title="Admin tools coming soon">
        <img src="/assets/icons/account-icon.svg" alt="Admin tools">
      </button>
    <% } %>
    
    <button class="top-btn"><img src="/assets/icons/notifications.svg" alt="Notifications"></button>
  </div>
</nav>
<div class="main-layout">
  <nav class="nav-bar">
    <div class="nav-items-container">
      <ul>
        <li>
          <a href="/index" class="nav-link">
            <img src="/assets/icons/home-icon.svg" alt="Home">
            <span>Home</span>
          </a>
        </li>
        <li>
          <a href="/contacts" class="nav-link">
            <img src="/assets/icons/contacts.svg" alt="Contacts">
            <span>Contacts</span>
          </a>
        </li>
        <li>
          <a href="/view-lots" class="nav-link">
            <img src="/assets/icons/community-icon.svg" alt="Community">
            <span>Community</span>
          </a>
        </li>
        <li>
          <a href="/my-community-competition" class="nav-link">
            <img src="/assets/icons/competition.svg" alt="Competition">
            <span>Competition</span>
          </a>
        </li>
        <li>
          <a href="/task" class="nav-link">
            <img src="/assets/icons/add_task.svg" alt="Task">
            <span>Task</span>
          </a>
        </li>
        <% if (canAccessAdmin) { %>
          <li class="admin-item">
            <a href="/admin-section" class="nav-link">
              <img src="/assets/icons/account-icon.svg" alt="Admin">
              <span>Admin</span>
            </a>
          </li>
        <% } %>
        <li class="logout-item">
          <form action="/logout" method="post">
            <button class="nav-link nav-button" type="submit">
              <img src="/assets/icons/logout.svg" alt="Logout">
              <span>Logout</span>
            </button>
          </form>
        </li>
      </ul>
    </div>
  </nav>
  <% if (permissions && permissions.isImpersonating && permissions.impersonation) { %>
    <div class="impersonation-banner" style="background-color:#fff3cd;color:#5f370e;padding:0.75rem 1rem;font-weight:600;border-bottom:1px solid #f0ad4e;">
      Impersonating <span><%= permissions.impersonation.companyName || permissions.impersonation.companyId %></span>. Visit the
      <a href="/admin-section" style="color:inherit;text-decoration:underline;">Admin Section &rarr; Impersonation</a> tab to stop.
    </div>
  <% } %>
</div>
