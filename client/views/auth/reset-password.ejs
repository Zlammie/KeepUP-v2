<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Set password Â· KeepUP</title>
  <link rel="preconnect" href="/" />
  <link rel="stylesheet" href="/assets/css/auth.css" />
</head>
<body class="auth no-nav">
  <% const viewMode = typeof mode === 'string' ? mode : 'reset'; %>
  <% const isInvite = viewMode === 'invite'; %>
  <% const showForm = token && status !== 'error'; %>
  <main class="auth__wrap">
    <section class="auth__card" role="form" aria-labelledby="reset-title">
      <header class="auth__header">
        <h1 id="reset-title" class="auth__title"><%= isInvite ? 'Set your password' : 'Create a new password' %></h1>
        <p class="auth__subtitle">
          <%= isInvite ? 'Choose a password to activate your account.' : 'Enter your new password below.' %>
        </p>
      </header>

      <% if (error || message) { %>
        <% const isSuccess = status === 'success'; %>
        <div class="auth__alert <%= isSuccess ? 'auth__alert--success' : '' %>" role="alert" aria-live="polite">
          <span class="auth__alert-dot" aria-hidden="true"></span>
          <%= error || message %>
        </div>
      <% } %>

      <% if (showForm) { %>
        <form method="POST" action="/reset-password" class="auth__form">
          <input type="hidden" name="token" value="<%= token %>" />

          <% if (email) { %>
            <div class="field">
              <label class="label">Account</label>
              <div class="muted"><%= email %></div>
            </div>
          <% } %>

          <div class="field">
            <label for="password" class="label">New password</label>
            <input
              id="password"
              name="password"
              type="password"
              required
              minlength="8"
              autocomplete="new-password"
              class="input"
              placeholder="At least 8 characters"
            />
          </div>

          <div class="field">
            <label for="confirmPassword" class="label">Confirm password</label>
            <input
              id="confirmPassword"
              name="confirmPassword"
              type="password"
              required
              minlength="8"
              autocomplete="new-password"
              class="input"
              placeholder="Re-enter your password"
            />
          </div>

          <button type="submit" class="btn btn--primary">Save password</button>
        </form>
      <% } else { %>
        <p class="muted">Request a new link to continue.</p>
        <a href="/forgot-password" class="link">Send me a new link</a>
      <% } %>

      <footer class="auth__footer">
        <a href="/login" class="link">Return to sign in</a>
      </footer>
    </section>
  </main>
</body>
</html>
